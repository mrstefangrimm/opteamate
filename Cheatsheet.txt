Cheatcheat for Opteamate Developers
-----------------------------------


IIS and LetsEncypt
------------------
https://tecadmin.net/iis-redirect-http-to-https/
https://stackoverflow.com/questions/43409878/set-web-config-for-letsencrypt-certify-with-asp-net-core-and-angular-2-javasc
https://weblog.west-wind.com/posts/2017/sep/09/configuring-letsencrypt-for-aspnet-core-and-iis
https://letsencrypt.org/de/docs/client-options/
https://certbot.eff.org/lets-encrypt/windows-webproduct
https://www.windowspro.de/roland-eich/zertifikat-fuer-iis-exchange-lets-encrypt-ausstellen

Add Asp.Net Angular to IIS
https://www.youtube.com/watch?v=ZG-6z4BQmRI
https://www.youtube.com/watch?v=xYnlt_UrNcs
set to outofprocess: https://stackoverflow.com/questions/53811569/http-error-500-30-ancm-in-process-start-failure
C:\Users\Stefan Grimm\Documents\github\opteamate\OpteaMate\bin\Release\netcoreapp3.1\publish\web.config
https://docs.microsoft.com/en-us/aspnet/core/host-and-deploy/aspnet-core-module?view=aspnetcore-3.1



Manual deployment and execution
-------------------------------
Currently not working because "Release" configuration is going to the production server (opteamate.dynv6.net).
To serve the agular app locally that is accessable from the intranet
ng serve --prod --port 4700 --host 0.0.0.0 --disableHostCheck true
http://192.168.178.20:4700/ => CORS Error

1) Start angular and Asp.NET with "OpteaMate.Web.exe" in .\OpteaMate\bin\Release\netcoreapp3.1\publish
2) Copy ".\OpteaMate\opteamate.db" to \OpteaMate\bin\Release\netcoreapp3.1\publish\ClientApp\dist
3) "http-server -p 4200" in .\OpteaMate\bin\Release\netcoreapp3.1\publish\ClientApp\dist
http://192.168.178.20:4700/ => CORS Error


end-to-end testing
------------------
e2e serves angular app locally (ng serve) and connects to the production server (opteamate.dynv6.net).
ng e2e --prod --port 4700
--prod => 'https://opteamate.dynv6.net/api/toc' in toc.service.ts 
--port 4700 => CORS in Startup.cs allows to use opteamate.dynv6.net from localhost

Manual Release testing
----------------------
When Visual Studio configuration Release is used, the TOC runs locally but the data comes from the production server (opteamate.dynv6.net).
Release => TocService.GetBaseUrl() => https://opteamate.dynv6.net
Debug => TocServiceFake.GetBaseUrl() => http://localhost:4700

CURL
----
https://curl.haxx.se/docs/httpscripting.html
HTTPS: curl --insecure GET ...
curl GET http://localhost:4700/api/events/1 | json_pp
curl GET --header "user:admin" --header "user:guest" http://localhost:4700/api/events | json_pp
curl GET http://localhost:4700/api/optima | json_pp
curl GET "http://localhost:4700/api/events/byevent?token=E72BC57E-339B-42C7-8ED9-4650346B6565" | json_pp
curl GET "http://localhost:4700/api/events/bygroup?token=E85521F1-DBBA-4DFF-B4DA-982B8DF7FED0" | json_pp
curl GET "http://localhost:4700/api/events/byToken?key=event&token=E72BC57E-339B-42C7-8ED9-4650346B6565" | json_pp
curl GET "http://localhost:4700/api/events/byToken?key=group&token=E85521F1-DBBA-4DFF-B4DA-982B8DF7FED0" | json_pp


curl --header "Content-Type: application/json" --request POST --data '{ "EventToken":"E72BC57E-339B-42C7-8ED9-4650346B6565", "Title":"tit","Location":"Loc", "Start":"2020-10-06T19:00:00", "OptimumId":1 }' http://localhost:4700/api/events/  | json_pp
curl POST --data '{ "nickname":"Hausi" }' http://localhost:5000/api/events/1/registrations  | json_pp


NUGET
-----
nuget cmdline in Visual Studio:
Install-Package Microsoft.AspNetCore.SpaServices.Extensions
Install-Package Microsoft.EntityFrameworkCore.Sqlite


SQLite DB
---------
Generate new DB from the source code
https://docs.microsoft.com/en-us/ef/core/get-started/?tabs=visual-studio
Delete the opteamat.db
Delete the Migration folder
in package manager:
Add-Migration InitialCreate
Update-Database


